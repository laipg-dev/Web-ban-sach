<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ƒê·∫∑t h√†ng th√†nh c√¥ng | Bookshop</title>
    <link rel="stylesheet" href="style.css" />
    <style>
      .success-container {
        max-width: 600px;
        margin: 50px auto;
        padding: 20px;
        text-align: center;
      }

      .success-card {
        background: white;
        padding: 40px 20px;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        border-top: 5px solid #27ae60;
      }

      .success-icon {
        font-size: 64px;
        color: #27ae60;
        margin-bottom: 20px;
      }

      .success-title {
        font-size: 24px;
        font-weight: bold;
        color: #27ae60;
        margin-bottom: 10px;
      }

      .success-message {
        color: #666;
        margin-bottom: 30px;
        line-height: 1.6;
      }

      .order-info {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 30px;
        text-align: left;
      }

      .order-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
      }

      .order-row:last-child {
        margin-bottom: 0;
        font-weight: bold;
        color: #e74c3c;
        border-top: 1px solid #dee2e6;
        padding-top: 10px;
      }

      .qr-payment-info {
        background: #e3f2fd;
        border: 1px solid #2196f3;
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
      }

      .qr-payment-info h4 {
        color: #1976d2;
        margin-bottom: 15px;
      }

      .payment-details {
        text-align: left;
      }

      .payment-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
      }

      .payment-amount {
        font-weight: bold;
        color: #e74c3c;
      }

      .action-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
      }

      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        text-decoration: none;
        display: inline-block;
        transition: all 0.3s;
      }

      .btn-primary {
        background: #4a90e2;
        color: white;
      }

      .btn-primary:hover {
        background: #357abd;
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
      }

      .btn-secondary:hover {
        background: #5a6268;
      }

      .btn-success {
        background: #27ae60;
        color: white;
      }

      .btn-success:hover {
        background: #219a52;
      }

      .note {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        color: #856404;
        padding: 15px;
        border-radius: 6px;
        margin: 20px 0;
        text-align: left;
      }

      .note strong {
        display: block;
        margin-bottom: 5px;
      }

      @media (max-width: 768px) {
        .success-container {
          margin: 20px auto;
          padding: 10px;
        }

        .action-buttons {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header>
      <h1><a href="index.html" class="back-btn">üè† Trang ch·ªß</a></h1>
      <nav>
        <a href="cart.html" class="cart-btn"
          >üõí Gi·ªè h√†ng <span id="cart-count">0</span></a
        >
      </nav>
    </header>

    <div class="success-container">
      <div class="success-card">
        <div class="success-icon">‚úÖ</div>
        <h1 class="success-title">ƒê·∫∑t h√†ng th√†nh c√¥ng!</h1>
        <p class="success-message">
          C·∫£m ∆°n b·∫°n ƒë√£ mua s·∫Øm t·∫°i Bookshop. ƒê∆°n h√†ng c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c ti·∫øp nh·∫≠n
          v√† ƒëang ƒë∆∞·ª£c x·ª≠ l√Ω.
        </p>

        <div class="order-info">
          <div class="order-row">
            <span>M√£ ƒë∆°n h√†ng:</span>
            <span id="order-id">--</span>
          </div>
          <div class="order-row">
            <span>Th·ªùi gian ƒë·∫∑t:</span>
            <span id="order-time">--</span>
          </div>
          <div class="order-row">
            <span>Ph∆∞∆°ng th·ª©c thanh to√°n:</span>
            <span id="payment-method">--</span>
          </div>
          <div class="order-row">
            <span>T·ªïng ti·ªÅn:</span>
            <span id="total-amount">--</span>
          </div>
        </div>

        <!-- QR Payment Information (shown only for QR payment) -->
        <div
          id="qr-payment-section"
          class="qr-payment-info"
          style="display: none"
        >
          <h4>üí≥ Th√¥ng tin chuy·ªÉn kho·∫£n</h4>
          <div class="payment-details">
            <div class="payment-row">
              <span>Ng√¢n h√†ng:</span>
              <strong>Vietcombank</strong>
            </div>
            <div class="payment-row">
              <span>S·ªë t√†i kho·∫£n:</span>
              <strong>0123456789</strong>
            </div>
            <div class="payment-row">
              <span>T√™n t√†i kho·∫£n:</span>
              <strong>BOOKSHOP STORE</strong>
            </div>
            <div class="payment-row">
              <span>S·ªë ti·ªÅn c·∫ßn chuy·ªÉn:</span>
              <span class="payment-amount" id="transfer-amount">--</span>
            </div>
            <div class="payment-row">
              <span>N·ªôi dung chuy·ªÉn kho·∫£n:</span>
              <strong id="transfer-content">--</strong>
            </div>
          </div>
        </div>

        <!-- COD Information -->
        <div id="cod-payment-section" class="note" style="display: none">
          <strong>üì¶ Thanh to√°n khi nh·∫≠n h√†ng (COD)</strong>
          B·∫°n s·∫Ω thanh to√°n b·∫±ng ti·ªÅn m·∫∑t khi nh·∫≠n ƒë∆∞·ª£c h√†ng t·ª´ shipper. Vui
          l√≤ng chu·∫©n b·ªã ƒë·ªß ti·ªÅn m·∫∑t theo ƒë√∫ng s·ªë ti·ªÅn tr√™n.
        </div>

        <div class="note">
          <strong>üìû Li√™n h·ªá h·ªó tr·ª£:</strong>
          N·∫øu b·∫°n c√≥ b·∫•t k·ª≥ c√¢u h·ªèi n√†o v·ªÅ ƒë∆°n h√†ng, vui l√≤ng li√™n h·ªá hotline:
          <strong>1900-xxxx</strong> ho·∫∑c email:
          <strong>support@bookshop.com</strong>
        </div>

        <div class="action-buttons">
          <a href="profile.html#orders" class="btn btn-primary">
            üìã Xem ƒë∆°n h√†ng
          </a>
          <a href="index.html" class="btn btn-secondary">
            üè† Ti·∫øp t·ª•c mua s·∫Øm
          </a>
          <button id="print-order" class="btn btn-success">
            üñ®Ô∏è In ƒë∆°n h√†ng
          </button>
        </div>
      </div>
    </div>

    <script>
      // Constants
      const fmt = (n) => (n || 0).toLocaleString("vi-VN") + "ƒë";

      document.addEventListener("DOMContentLoaded", function () {
        loadOrderInfo();
        updateCartBadge();
        setupPrintButton();
      });

      // Load order information
      function loadOrderInfo() {
        try {
          const orderSuccess = JSON.parse(
            localStorage.getItem("order_success") || "{}"
          );

          if (!orderSuccess.orderId) {
            // N·∫øu kh√¥ng c√≥ th√¥ng tin ƒë∆°n h√†ng, chuy·ªÉn v·ªÅ trang ch·ªß
            alert("Kh√¥ng t√¨m th·∫•y th√¥ng tin ƒë∆°n h√†ng!");
            window.location.href = "index.html";
            return;
          }

          // Hi·ªÉn th·ªã th√¥ng tin ƒë∆°n h√†ng
          document.getElementById("order-id").textContent =
            orderSuccess.orderId;
          document.getElementById("order-time").textContent =
            new Date().toLocaleString("vi-VN");
          document.getElementById("total-amount").textContent = fmt(
            orderSuccess.totalAmount
          );

          // Hi·ªÉn th·ªã th√¥ng tin theo ph∆∞∆°ng th·ª©c thanh to√°n
          if (orderSuccess.paymentMethod === "qr") {
            document.getElementById("payment-method").textContent =
              "Chuy·ªÉn kho·∫£n QR";
            document.getElementById("qr-payment-section").style.display =
              "block";
            document.getElementById("transfer-amount").textContent = fmt(
              orderSuccess.totalAmount
            );
            document.getElementById(
              "transfer-content"
            ).textContent = `THANHTOAN ${orderSuccess.orderId}`;
          } else if (orderSuccess.paymentMethod === "cod") {
            document.getElementById("payment-method").textContent =
              "Thanh to√°n khi nh·∫≠n h√†ng (COD)";
            document.getElementById("cod-payment-section").style.display =
              "block";
          }

          // X√≥a th√¥ng tin ƒë∆°n h√†ng kh·ªèi localStorage sau khi hi·ªÉn th·ªã
          localStorage.removeItem("order_success");
        } catch (error) {
          console.error("Error loading order info:", error);
          alert("C√≥ l·ªói x·∫£y ra khi t·∫£i th√¥ng tin ƒë∆°n h√†ng!");
          window.location.href = "index.html";
        }
      }

      // Update cart badge
      function updateCartBadge() {
        try {
          const cart = JSON.parse(localStorage.getItem("cart_user1") || "[]");
          const badge = document.getElementById("cart-count");
          if (badge) {
            badge.textContent = cart.reduce(
              (sum, item) => sum + (item.quantity || 0),
              0
            );
          }
        } catch (error) {
          console.error("Error updating cart badge:", error);
        }
      }

      // Setup print button
      function setupPrintButton() {
        document
          .getElementById("print-order")
          .addEventListener("click", function () {
            window.print();
          });
      }

      // Print styles
      const printStyles = `
            <style>
                @media print {
                    body * { visibility: hidden; }
                    .success-container, .success-container * { visibility: visible; }
                    .success-container { position: absolute; left: 0; top: 0; width: 100%; }
                    .action-buttons { display: none !important; }
                    header { display: none !important; }
                }
            </style>
        `;
      document.head.insertAdjacentHTML("beforeend", printStyles);
    </script>
  </body>
</html>
